#!/bin/sh

set -e

web_env() {
  source $(brew --prefix nvm)/nvm.sh
  cd ${HOME}/code/versal.com
  nvm use 0.10
  ulimit -n 4096
}

if [ -z "${1}" ]; then
  web_env
elif [ "${1}" = "all" ]; then
  web_env
  time grunt || true
  web sync
elif [ "${1}" = "build" ]; then
  web_env
  time grunt buildClient || true
  web sync
elif [ "${1}" = "ctest" ]; then
  web_env
  time grunt clientTest
elif [ "${1}" = "stest" ]; then
  web_env
  time grunt serverTest
elif [ "${1}" = "fast" ]; then
  web_env
  time grunt stylus coffee:cgm requirejs:cgm || true
  web sync
elif [ "${1}" = "sync" ]; then
  web_env
  time vagrant rsync
elif [ "${1}" = "restart" ]; then
  web_env
  ./dev/tasks.sh restart
else
  echo "Usage: web [all|build|test|fast|sync|restart]"
  exit 1
fi
